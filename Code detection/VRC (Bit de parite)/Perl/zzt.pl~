#!/usr/bin/perl

use strict;
use Physique::LinkUDP;
use Physique::Debug;
use Parity;

sub verification {
	my $car = ord($_[0]);

# question du sujet
# [
#    La vérification d'un caractère (en)codé puis modifié sur 1 bit est toujours mauvaise :
#    $car = $car ^ 1; 
#    on revient a l'etat d'origine du caractere si il est impair ou on le transforme en impair
#    puisque si cela était pair, le changement d'un 0 en un 1 ou d'un 1 en un 0 le fait devenir impair
# ]


# retour du resultat du test de la parité de ce caractere :
	return not Parity::parity($car);	
}


sub decodage {
	my $car = ord($_[0]);

# ou retourner le caractere vide si il y a erreur :
	return '' unless ( verification(chr($car)) );

# retourner le decodage du caractere par decalage à droite si la paritée est respectée :
	return chr( $car >> 1);
}


my $link = P_open(@ARGV);

print decodage(P_recoitCar($link));

print "\n";

P_close($link);

